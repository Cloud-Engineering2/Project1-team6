<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>회원가입</title>
</head>

<body>
	<h1>회원가입</h1>
	<form id="signupForm" method="POST" th:action="@{/api/auth/signup}">
		<label for="username">아이디</label>
		<input type="text" id="username" name="username" required>
		<div id="usernameError" style="color: red;"></div>

		<label for="email">이메일</label>
		<input type="email" id="email" name="email" required>
		<div id="emailError" style="color: red;"></div>

		<label for="password">비밀번호</label>
		<input type="password" id="password" name="password" required>

		<button type="submit">회원가입</button>
	</form>

	<script th:inline="javascript">
		document.getElementById('signupForm').addEventListener('submit', function (event) {
			event.preventDefault();

			const username = document.getElementById('username').value;
			const email = document.getElementById('email').value;
			const password = document.getElementById('password').value;

			document.getElementById('usernameError').innerText = '';
			document.getElementById('emailError').innerText = '';

			fetch(/*[[@{/api/auth/signup}]]*/, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({username, email, password})
			})
				.then(response => {
					if (!response.ok) {
						return response.text().then(errorMessage => {
							throw new Error(errorMessage);
						});
					}
					return response.text();
				})
				.then(message => {
					alert(message);
					window.location.href = "/login";
				})
				.catch(error => {
					if (error.message.includes("아이디")) {
						document.getElementById('usernameError').innerText = error.message;
					} else if (error.message.includes("이메일")) {
						document.getElementById('emailError').innerText = error.message;
					} else {
						alert('회원가입 중 문제가 발생했습니다. 다시 시도해주세요.');
					}
				});

		});
	</script>
</body>

</html>